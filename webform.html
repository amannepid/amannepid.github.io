<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    var isAndroid = /(android)/i.test(navigator.userAgent);
    var onLoadCalledOnce = false;

    function querySt(ji) {
      hu = window.location.search.substring(1);
      gy = hu.split("&");
      for (i = 0; i < gy.length; i++) {
        ft = gy[i].split("=");
        if (ft[0] == ji) {
          return decodeURIComponent(ft[1]);
        }
      }
      return null;
    }

    function creHandleErrors(errorCode) {
      console.log("errorCode: " + errorCode);
    }

    function creHandleDetailErrors(errorCode, gatewayCode, gatewayMessage) {
      console.log("errorCode: " + errorCode);
      console.log("gatewayCode: " + gatewayCode);
      console.log("gatewayMessage: " + gatewayMessage);

      var errors = errorCode.split("|");
      var errorMessage = "";

      switch (errors[0]) {
        case '310':
          errorMessage = "Please enter your credit card number.";
          break;
        case '315':
        case '839':
        case '841':
          errorMessage = "Please verify your credit card number and correct as needed.";
          break;
        case '320':
          errorMessage = "Please verify your credit card type and correct as needed.";
          break;
        case '330':
        case '340':
          errorMessage = "Please enter your credit card expiration date.";
          break;
        case '360':
          errorMessage = "Your payment was declined by your financial institution.  Please verify the data entered and try again.";
          break;
        case '370':
          errorMessage = "Please verify your credit card expiration date and correct as needed.";
          break;
        case '100':
        case '110':
        case '200':
        case '350':
        case '355':
        case '500':
        case '510':
        case '520':
        case '530':
        case '531':
        case '516':
        case '521':
        case '20421':
        case '9582':
          errorMessage = "We experienced an error when processing your transaction.  Please try again later.";
          break;
      }

      console.log(errorMessage);

      if (isAndroid) {
        Android.displayErrors(errorMessage)
      }
    }

    function completeCREPayment(transaction) {
      console.log("transaction: " + transaction);

      if (isAndroid) {

        if (typeof Android.completePayment == 'function') {
          Android.completePayment(transaction.ccNumber, transaction.ccType, transaction.expMonth, transaction.expYear, transaction.customerRefNum);
        }

        if (typeof Android.completePaymentV2 == 'function') {
          Android.completePayment(transaction.code, transaction.uID, transaction.message, transaction.rurl);
        }

      }
    }

    function startCREPayment() {
      console.log("startCREPayment");

      if (isAndroid) {
        Android.startPayment();
      }
    }

    function onLoad() {
      if (onLoadCalledOnce) {
        console.log("loaded twice");
        iFrameFinishedLoading();
      } else {
        onLoadCalledOnce = true;
        console.log("loaded once");
      }
    }

    function iFrameFinishedLoading() {
      if (isAndroid) {
        Android.iFrameFinishedLoading();
      }
    }
  </script>
  <title>This is a butt</title>
</head>

<body>
  <iframe id="form" style="position:fixed; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;" onload="onLoad()">
  </iframe>

  <script type="text/javascript" language="JavaScript">
    document.getElementById("form").setAttribute("src", querySt('src'));
  </script>
</body>

</html>
